{
  "name": "MVTracker Dev",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },

  "runArgs": [
    "--gpus", "all",
    "--shm-size=64g",   // or more, e.g. 64g
    "--ipc=host"        // optional: share host IPC to remove the cap

    // ðŸ‘‰ SSH agent forwarding disabled since SSH_AUTH_SOCK is not set on host
    // ðŸ‘‰ Using mounted ~/.ssh instead (see mounts section below)
  ],

  "mounts": [
    // "source=/tmp/.X11-unix,target=/tmp/.X11-unix,type=bind",
    // "source=${localEnv:HOME}/.Xauthority,target=/root/.Xauthority,type=bind",
    "source=/home/nfs/datasets/internal,target=/data,type=bind,consistency=cached,readonly=false",
    "source=${localEnv:HOME}/.ssh,target=/root/.ssh,type=bind,readonly",  // optional: forward host SSH keys for GitHub
    // "source=/home/nfs/datasets/internal,target=/workspace/external_data,type=bind,consistency=cached,readonly=false", 
    "source=${localEnv:HOME}/.codex,target=/root/.codex,type=bind"         // persist Codex auth from host

    // NOTE: if you prefer to *not* mount any secrets, comment the above lines and rely purely on SSH agent.
  ],
  "containerEnv": {
  //   "DISPLAY": "${localEnv:DISPLAY}",
  //   "XAUTHORITY": "/root/.Xauthority"
    "CODEX_HOME": "/root/.codex", // ensure Codex looks at the mounted creds
    "TORCH_CUDA_ARCH_LIST": "80;86;89;90;100"

  },

  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
  "workspaceFolder": "/workspace",

  "forwardPorts": [7860],

  // OLD (kept): only pointops, no torch version pin, no flash-attn
  // "postCreateCommand": "python -m pip install --upgrade pip && pip install -r requirements.txt || true && pip install -r /tmp/requirements.full.txt && rm /tmp/requirements.txt /tmp/requirements.full.txt  && pip install 'git+https://github.com/ethz-vlg/pointcept.git@2082918#subdirectory=libs/pointops'",
  // && pip install --upgrade --no-build-isolation flash-attn==2.5.8

  // NEW: Torch 2.7.x (cu128) + rebuild CUDA ops for sm_100 and friends
  "postCreateCommand": "/bin/bash .devcontainer/post-create.sh",
  // "postStartCommand": "cp ${localEnv:HOME}/.Xauthority /root/.Xauthority 2>/dev/null || true; chmod 644 /root/.Xauthority 2>/dev/null || true",


  "customizations": {
    "vscode": {
      // "extensions": ["ms-pythoaw2aaaaaaan.python", "ms-toolsai.jupyter"] // original
      "extensions": ["ms-python.python", "ms-toolsai.jupyter"] // corrected Python extension id
    }
  }
}